---
name: security-check
description: 認証、データ処理、一般的な脆弱性に関するセキュリティ検証チェックリスト。認証、パスワード、機密データを扱う際に自動的にロードされます。
---

# セキュリティチェック

## 🔐 認証と認可

### パスワードセキュリティ
- [ ] 強力なハッシュアルゴリズムを使用（bcrypt/argon2、rounds ≥ 12）
- [ ] パスワードは平文で保存しない
- [ ] パスワードはログに出力しない
- [ ] パスワードリセット時にセキュアなトークンを使用

### トークン管理
- [ ] 強力なシークレットで署名
- [ ] トークンに有効期限を設定
- [ ] リフレッシュトークンの実装
- [ ] HTTP-only cookieに保存（Webの場合）
- [ ] Secure flagを設定（HTTPS環境）

### セッション管理
- [ ] セッションタイムアウト実装
- [ ] ログアウト時にセッション破棄
- [ ] 並行セッション制限（必要に応じて）

## 🛡️ 入力バリデーション

### インジェクション対策
- [ ] SQLは必ずパラメータ化クエリを使用
- [ ] コマンド実行時は入力をエスケープ
- [ ] テンプレートエンジンでの自動エスケープを有効化

**原則:**
```
❌ 悪い: 文字列結合でクエリを構築
✅ 良い: プレースホルダーとパラメータを使用
```

### XSS対策
- [ ] ユーザー入力をHTMLに出力する前にエスケープ
- [ ] Content-Security-Policy ヘッダーを設定
- [ ] innerHTML や同等の機能を使用しない

### 入力サニタイゼーション
- [ ] 全入力をバリデーション
- [ ] ホワイトリスト方式を採用
- [ ] 型チェック実装
- [ ] 長さ制限を設定

## 🌐 APIセキュリティ

### CORS設定
- [ ] 必要なオリジンのみ許可
- [ ] ワイルドカード (*) を本番環境で使用しない

### レート制限
- [ ] APIエンドポイントにレート制限を実装
- [ ] 認証エンドポイントは特に厳しく制限

### CSRF保護
- [ ] CSRFトークンを実装
- [ ] SameSite cookie属性を設定
- [ ] 状態変更リクエストでトークンを検証

## 🔒 データ保護

### 機密データ
- [ ] 環境変数で機密情報を管理
- [ ] シークレットファイルをバージョン管理に含めない
- [ ] APIキーをコードにハードコードしない
- [ ] ログに機密情報を出力しない

### 暗号化
- [ ] 通信はHTTPS/TLSを使用
- [ ] 保存時に機密データを暗号化
- [ ] TLS 1.2以上を使用

## 🚨 一般的な脆弱性

### OWASP Top 10チェック
1. [ ] インジェクション攻撃対策
2. [ ] 認証の脆弱性対策
3. [ ] センシティブデータの露出対策
4. [ ] XML External Entities (XXE)対策
5. [ ] アクセス制御の不備対策
6. [ ] セキュリティ設定ミス対策
7. [ ] クロスサイトスクリプティング(XSS)対策
8. [ ] 安全でないデシリアライゼーション対策
9. [ ] 既知の脆弱性を持つコンポーネント対策
10. [ ] 不十分なロギング・監視対策

## 🛠️ セキュリティツール

### 依存関係の脆弱性チェック
プロジェクトの言語/パッケージマネージャに応じたツールを使用:
- 依存関係の監査機能
- 脆弱性データベースとの照合
- 定期的な更新

### 静的解析
- セキュリティ focused な静的解析ツールを導入
- CI/CDパイプラインに組み込み

## 🔍 レビュー質問

実装前に自問：
1. このコードは信頼できない入力を扱うか？
2. 認証・認可が必要か？
3. 機密情報を扱うか？
4. 外部APIと通信するか？
5. ユーザーデータを保存するか？

1つでも「はい」なら、対応するセキュリティ対策を確認してください。
